########################################
# Mirror V4 â€” .env.full.example
# Based on Tommy's working config (paths adjusted to relative).
########################################

# ----- Paths -----
SCROLLS_DIR=./lore-scrolls
WEB_DIR=./web
LEDGER_DB=./mirror-v4.db
PROMPTS_DIR=./prompts

# ----- Server -----
APP_NAME=Mirror V4
HOST=0.0.0.0
PORT=8080
LOG_LEVEL=info
ROOT_PATH=

# CORS/Hosts
ALLOWED_HOSTS=toadaid.duckdns.org,localhost,127.0.0.1,*.ngrok-free.app
CORS_ORIGINS=https://toadaid.github.io,https://www.toadaid.github.io,https://toadaid.duckdns.org

# ----- Harmony / thresholds -----
HARMONY_THRESHOLD=0.72
REQUIRE_CITATION=true
LLM_FALLBACK_MODE=strict

# ----- LLM (V4) -----
MIRROR_LLM_ENABLED=1
LLM_BASE_URL=http://127.0.0.1:1234/v1
LLM_MODEL=meta-llama-3.1-8b-instruct
LLM_API_KEY=lm-studio
LLM_TIMEOUT_SECS=45
LLM_MIN_OK_CHARS=120

# ----- Reply length controls -----
MAX_SENTENCES=18
MAX_CHARS=2500
LLM_MAX_TOKENS=1200

# ----- Feature flags -----
TEMPORAL_CONTEXT=true
CONVERSATION_WEAVE=true
SYMBOL_RESONANCE=true
SHOW_SOURCES=0
DISABLE_STARTUP_INDEX=0
V4_EXPERIMENTAL=false

# Retrieval / Synthesis tuning
RETRIEVER_TOPK_RAW=120
RETRIEVER_TOPK_FINAL=48
RETRIEVER_MIN_SCORE=0.20
RETRIEVER_BM25_WEIGHT=0.55
RETRIEVER_EMB_WEIGHT=0.45
RETRIEVER_TOPK_PER_ARC=16

CANON_ANCHORS_WHO=TOBY_L025,TOBY_QA127
CANON_ANCHORS_LEAF=TOBY_L110,TOBY_L028
CANON_ANCHORS_TABOSHI=TOBY_L110,TOBY_L057

# Sanitizer (keep both until code unified)
SANITIZE_ENABLED=true
ANITIZE_ENABLED=true

# Style gates
MIRROR_STYLE_DEFAULT=reflect
MIRROR_ECHO_QUESTION=0
MIRROR_TELEGRAM_DEFLOWER=1
MIRROR_USE_SYMBOLS=1
MIRROR_MIN_REFLECTIONS=10
MIRROR_TARGET_UPPER=12
MIRROR_MAX_ARROWS=12
MIRROR_MAX_LINES=14
SCROLL_MAX_KEYMARKS=6

# Memori
MEMORI_DB=./memori.db
MEMORI_DSN=sqlite:////absolute/path/to/memori.db
MEMORI_URL=http://127.0.0.1:8080
MEMORI_TOKEN=changeme
MEMORI_PULL_ASK=0
MEMORI_LOG_ASK=0
MEMORI_PULL_LIMIT=12
MEMORI_TTL_DAYS=45
MEMORI_FORGET=1
MEMORI_KIND_ALLOWLIST=ask,note,context
MEMORI_ENABLE_CONSCIOUS=false
MEMORI_ENABLE_AUTO=false

# Local LLM only
USE_OPENAI=false
OPENAI_API_KEY=

# Planner
PLANNER_PROVIDER=local
PLANNER_BASE=http://127.0.0.1:1234/v1
PLANNER_MODEL=meta-llama-3.1-8b-instruct
PLANNER_STRUCTURED=false

# Locale
PYTHONUTF8=1
PYTHONIOENCODING=UTF-8
LC_ALL=en_US.UTF-8
LANG=en_US.UTF-8

# Prometheus / Uvicorn
PROMETHEUS_ENABLED=true
PROMETHEUS_MULTIPROC_DIR=/tmp/mirror_prom_mp
UVICORN_WORKERS=2

# Telegram Bot (disabled by default; fill tokens when used)
TELEGRAM_MODE=webhook
TELEGRAM_BOT_TOKEN=
TELEGRAM_RATE_N=12
TELEGRAM_RATE_WINDOW_S=60
TELEGRAM_CMD_START=/start
TELEGRAM_CMD_PING=/ping
TELEGRAM_CMD_ASK=/ask
TELEGRAM_CMD_RELOAD=/reload
MIRROR_BASE_URL=http://127.0.0.1:8080
