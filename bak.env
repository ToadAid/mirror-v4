########################################
# Mirror V4 — combined environment
########################################

# ----- Paths -----
SCROLLS_DIR=/home/tommy/mirror-v4/lore-scrolls
WEB_DIR=/home/tommy/mirror-v4/web
LEDGER_DB=/home/tommy/mirror-v4/mirror-v4.db
PROMPTS_DIR=/home/tommy/mirror-v4/prompts

# Memori DB
MEMORI_DB=/home/tommy/mirror-v4/memori.db

# ----- Memori integration -----
MEMORI_LOG_ASK=true
MEMORI_URL=http://127.0.0.1:8080
MEMORI_TOKEN=supersecret
MEMORI_USE_QUERY=0                 # ← safer until you confirm POST /query works
MEMORI_PULL_ASK=true
MEMORI_PULL_LIMIT=12
MEMORI_TTL_DAYS=45
MEMORI_FORGET=true
MEMORI_KIND_ALLOWLIST=ask,note,context

# --- Memori: don’t spin LLM agents ---
MEMORI_ENABLE_CONSCIOUS=false
MEMORI_ENABLE_AUTO=false

# ----- Harmony / thresholds -----
HARMONY_THRESHOLD=0.72
REQUIRE_CITATION=true
LLM_FALLBACK_MODE=loose           # was "strict"; set to "loose" so LLM can answer on RAG miss

# ----- LLM (V4) -----
MIRROR_LLM_ENABLED=1
LLM_BASE_URL=http://127.0.0.1:1234/v1
LLM_MODEL=meta-llama-3.1-8b-instruct
LLM_API_KEY=lm-studio
LLM_TIMEOUT_SECS=45
LLM_MIN_OK_CHARS=200
LLM_MAX_TOKENS=1200
LLM_TEMPERATURE=0.4
LLM_TOP_P=0.9

# length + sampling
ANSWER_MAX_LINES=10
ANSWER_MIN_LINES=6
LLM_MIN_OK_CHARS=900
LLM_MAX_TOKENS=1200
LLM_TEMPERATURE=0.4
LLM_TOP_P=0.9


# strip metadata lines from answers
STRIP_META=1

# ----- Reply length controls -----
MAX_SENTENCES=10                  # sentence clamp (legacy)
ANSWER_MAX_LINES=10               # hard cap on non-empty lines
MAX_CHARS=1600                    # hard cap in characters (0 = unlimited)

# ----- Feature flags -----
TEMPORAL_CONTEXT=true
CONVERSATION_WEAVE=true
SYMBOL_RESONANCE=true
SHOW_SOURCES=0
DISABLE_STARTUP_INDEX=0
V4_EXPERIMENTAL=false

# ----- Retriever knobs -----
RETRIEVER_TOPK_RAW=120
RETRIEVER_TOPK_FINAL=48
RETRIEVER_MIN_SCORE=0.20
RETRIEVER_BM25_WEIGHT=0.55
RETRIEVER_EMB_WEIGHT=0.45
RETRIEVER_TOPK_PER_ARC=16

# ----- Sanitizer -----
SANITIZE_ENABLED=true

# ----- Rendering / synthesis tuning -----
MIRROR_STYLE_DEFAULT=reflect
MIRROR_ECHO_QUESTION=0
MIRROR_TELEGRAM_DEFLOWER=1
MIRROR_USE_SYMBOLS=1
MIRROR_MIN_REFLECTIONS=8          # was 10; keep under line cap
MIRROR_TARGET_UPPER=12
MIRROR_MAX_ARROWS=12
MIRROR_MAX_LINES=14
SCROLL_MAX_KEYMARKS=6

# ----- Canon pins -----
CANON_ANCHORS_WHO=TOBY_L025,TOBY_QA127
CANON_ANCHORS_LEAF=TOBY_L110,TOBY_L028
CANON_ANCHORS_TABOSHI=TOBY_L110,TOBY_L057

# ----- Prometheus multiprocess -----
PROMETHEUS_MULTIPROC_DIR=/tmp/prom_multiproc

# ----- V5 publish safety -----
V5_PUBLISH_ENABLED=false
V5_REQUIRE_REVIEW=true
V5_REVIEW_QUEUE=/home/tommy/mirror-v4/v5_review_queue.jsonl

########################################
# Telegram Bot (webhook or poll)
########################################

TELEGRAM_MODE=webhook
TELEGRAM_BOT_TOKEN=__REDACTED_TELEGRAM_BOT_TOKEN__
# TELEGRAM_SECRET_TOKEN=some-secret
# TELEGRAM_ALLOWLIST=123456789,@tommyng

# Ngrok (if you use it for webhook)
NGROK_AUTHTOKEN=__REDACTED_NGROK_TOKEN__

# Rate limit per chat
TELEGRAM_RATE_N=12
TELEGRAM_RATE_WINDOW_S=60

# Commands
TELEGRAM_CMD_START=/start
TELEGRAM_CMD_PING=/ping
TELEGRAM_CMD_ASK=/ask
TELEGRAM_CMD_RELOAD=/reload

# Where the bot forwards questions (your own V4 base)
MIRROR_BASE_URL=http://127.0.0.1:8080
